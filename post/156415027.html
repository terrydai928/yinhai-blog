<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>图解VMware vSAN安装(下：vSAN部署及管理安装) | 银海博客</title><meta name="author" content="Terry Dai"><meta name="copyright" content="Terry Dai"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="前言 这是《图解VMware vSAN安装(上：硬件及vSphere部署)》的下篇 本文1-6章节均为理论篇，摘选整理自VMware官网资料。 直接部署的话可以直接从《7 vSAN网络部署》开始  vSAN配置相关设计和优化内容可参考官方网站《vSAN 规划和部署》 https:&#x2F;&#x2F;docs.vmware.com&#x2F;cn&#x2F;VMware-vSphere&#x2F;7.0&#x2F;com.vmware.vsphere.v"><meta property="og:type" content="article"><meta property="og:title" content="图解VMware vSAN安装(下：vSAN部署及管理安装)"><meta property="og:url" content="https://www.yinhai-blog.com/post/156415027.html"><meta property="og:site_name" content="银海博客"><meta property="og:description" content="前言 这是《图解VMware vSAN安装(上：硬件及vSphere部署)》的下篇 本文1-6章节均为理论篇，摘选整理自VMware官网资料。 直接部署的话可以直接从《7 vSAN网络部署》开始  vSAN配置相关设计和优化内容可参考官方网站《vSAN 规划和部署》 https:&#x2F;&#x2F;docs.vmware.com&#x2F;cn&#x2F;VMware-vSphere&#x2F;7.0&#x2F;com.vmware.vsphere.v"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://www.yinhai-blog.com/img/Avatar.png"><meta property="article:published_time" content="2022-05-26T16:00:00.000Z"><meta property="article:modified_time" content="2024-04-02T16:00:24.433Z"><meta property="article:author" content="Terry Dai"><meta property="article:tag" content="虚拟化"><meta property="article:tag" content="vSAN"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://www.yinhai-blog.com/img/Avatar.png"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="canonical" href="https://www.yinhai-blog.com/post/156415027.html"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="//busuanzi.ibruce.info"><link rel="stylesheet" href="/css/index.css?v=4.13.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.min.css" media="print" onload='this.media="all"'><script>const GLOBAL_CONFIG={root:"/",algolia:void 0,localSearch:{path:"/search.xml",preload:!1,top_n_per_article:1,unescape:!1,languages:{hits_empty:"找不到您查询的内容：${query}",hits_stats:"共找到 ${hits} 篇文章"}},translate:{defaultEncoding:2,translateDelay:0,msgToTraditionalChinese:"繁",msgToSimplifiedChinese:"簡"},noticeOutdate:{limitDay:500,position:"top",messagePrev:"距离上次更新已经",messageNext:"天了，文章内容可能已经过时了，请注意甄别。如有疑问，请在评论区留言。"},highlight:{plugin:"highlight.js",highlightCopy:!0,highlightLang:!0,highlightHeightLimit:!1},copy:{success:"复制成功",error:"复制错误",noSupport:"浏览器不支持"},relativeDate:{homepage:!1,post:!1},runtime:"天",dateSuffix:{just:"刚刚",min:"分钟前",hour:"小时前",day:"天前",month:"个月前"},copyright:{limitCount:50,languages:{author:"作者: Terry Dai",link:"链接: ",source:"来源: 银海博客",info:"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},lightbox:"fancybox",Snackbar:void 0,infinitegrid:{js:"https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.11.1/dist/infinitegrid.min.js",buttonText:"加载更多"},isPhotoFigcaption:!1,islazyload:!1,isAnchor:!1,percent:{toc:!0,rightside:!0},autoDarkmode:!1}</script><script id="config-diff">var GLOBAL_CONFIG_SITE={title:"图解VMware vSAN安装(下：vSAN部署及管理安装)",isPost:!0,isHome:!1,isHighlightShrink:!1,isToc:!0,postUpdate:"2024-04-03 00:00:24"}</script><script>(e=>{e.saveToLocal={set:(e,t,a)=>{var o;0!==a&&(o=Date.now(),localStorage.setItem(e,JSON.stringify({value:t,expiry:o+864e5*a})))},get:e=>{var t=localStorage.getItem(e);if(t){t=JSON.parse(t);if(!(Date.now()>t.expiry))return t.value;localStorage.removeItem(e)}}},e.getScript=(o,n={})=>new Promise((t,e)=>{const a=document.createElement("script");a.src=o,a.async=!0,a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},Object.keys(n).forEach(e=>{a.setAttribute(e,n[e])}),document.head.appendChild(a)}),e.getCSS=(o,n=!1)=>new Promise((t,e)=>{const a=document.createElement("link");a.rel="stylesheet",a.href=o,n&&(a.id=n),a.onerror=e,a.onload=a.onreadystatechange=function(){var e=this.readyState;e&&"loaded"!==e&&"complete"!==e||(a.onload=a.onreadystatechange=null,t())},document.head.appendChild(a)}),e.activateDarkMode=()=>{document.documentElement.setAttribute("data-theme","dark"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#0d0d0d")},e.activateLightMode=()=>{document.documentElement.setAttribute("data-theme","light"),null!==document.querySelector('meta[name="theme-color"]')&&document.querySelector('meta[name="theme-color"]').setAttribute("content","#ffffff")};e=saveToLocal.get("theme"),"dark"===e?activateDarkMode():"light"===e&&activateLightMode(),e=saveToLocal.get("aside-status");void 0!==e&&("hide"===e?document.documentElement.classList.add("hide-aside"):document.documentElement.classList.remove("hide-aside"));/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)&&document.documentElement.classList.add("apple")})(window)</script><link rel="stylesheet" href="/css/custom.css?1"><meta name="generator" content="Hexo 7.1.1"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/Avatar.png" onerror='onerror=null,src="/img/friend_404.gif"' alt="avatar"></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">44</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><hr class="custom-hr"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-server"></i><span> 虚拟化</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/vSphere/"><span>vSphere</span></a></li><li><a class="site-page child" href="/vCenter/"><span>vCenter</span></a></li><li><a class="site-page child" href="/vSAN/"><span>vSAN</span></a></li><li><a class="site-page child" href="/vCloud-Director/"><span>vCloud-Director</span></a></li><li><a class="site-page child" href="/NSX/"><span>NSX</span></a></li><li><a class="site-page child" href="/KVM/"><span>KVM</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-clone"></i><span> 备份</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Veeam/"><span>Veeam</span></a></li><li><a class="site-page child" href="/Veritas/"><span>Veritas</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/Storage/"><i class="fa-fw fas fa-database"></i><span> 存储</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-coffee"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="银海博客"><span class="site-name">银海博客</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-server"></i><span> 虚拟化</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/vSphere/"><span>vSphere</span></a></li><li><a class="site-page child" href="/vCenter/"><span>vCenter</span></a></li><li><a class="site-page child" href="/vSAN/"><span>vSAN</span></a></li><li><a class="site-page child" href="/vCloud-Director/"><span>vCloud-Director</span></a></li><li><a class="site-page child" href="/NSX/"><span>NSX</span></a></li><li><a class="site-page child" href="/KVM/"><span>KVM</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-clone"></i><span> 备份</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/Veeam/"><span>Veeam</span></a></li><li><a class="site-page child" href="/Veritas/"><span>Veritas</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/Storage/"><i class="fa-fw fas fa-database"></i><span> 存储</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-coffee"></i><span> 更多</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/comment/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">图解VMware vSAN安装(下：vSAN部署及管理安装)</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="fa-fw post-meta-icon far fa-calendar-alt"></i><span class="post-meta-label">发表于</span><time datetime="2022-05-26T16:00:00.000Z" title="发表于 2022-05-27 00:00:00">2022-05-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E8%99%9A%E6%8B%9F%E5%8C%96%EF%BC%8CvSAN/">虚拟化，vSAN</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">9.7k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>32分钟</span></span><span class="post-meta-separator">|</span><span data-flag-title="图解VMware vSAN安装(下：vSAN部署及管理安装)"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="twikoo_visitors"><i class="fa-solid fa-spinner fa-spin"></i></span></span><span class="post-meta-separator">|</span><span class="post-meta-commentcount"><i class="far fa-comments fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/post/156415027.html#post-comment"><span id="twikoo-count"><i class="fa-solid fa-spinner fa-spin"></i></span></a></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><blockquote><p>这是《图解VMware vSAN安装(上：硬件及vSphere部署)》的下篇</p><p>本文1-6章节均为理论篇，摘选整理自VMware官网资料。</p><p>直接部署的话可以直接从《7 vSAN网络部署》开始</p></blockquote><p>vSAN配置相关设计和优化内容可参考官方网站《vSAN 规划和部署》</p><p><a target="_blank" rel="noopener" href="https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.vsphere.vsan-planning.doc/GUID-194D9B44-7593-4D3E-A9DD-A6646C1DCC05.html">https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.vsphere.vsan-planning.doc/GUID-194D9B44-7593-4D3E-A9DD-A6646C1DCC05.html</a></p><p>及VMware Docs</p><p><a target="_blank" rel="noopener" href="https://docs.vmware.com/cn/VMware-vSphere/index.html">https://docs.vmware.com/cn/VMware-vSphere/index.html</a></p><h2 id="1-vSAN部署要求"><a href="#1-vSAN部署要求" class="headerlink" title="1 vSAN部署要求"></a>1 vSAN部署要求</h2><p>1、一个标准 vSAN 集群至少包含三个主机。通常情况下，标准 vSAN 集群中的所有主机都位于同一位置，并在相同的第 2 层网络上相连接。全闪存配置需要 10Gb 网络连接，同时也建议对混合配置使用此设置。为达到最佳效果，请为 vSAN 集群配置四个或四个以上主机。</p><p>2、在集群上启用 vSAN 之前，必须禁用 vSphere HA。然后，可以重新启用 vSphere HA。</p><p>3、至少有一个固态硬盘作为缓存盘，启用“去重和压缩”必须全部都是全闪盘。</p><p>4、对于混合配置，专用带宽为 1 Gbps；对于全闪存配置，专用或共享带宽为 10 Gbp。</p><p>5、vSAN 集群中的每个主机都必须具有适用于 vSAN 流量的 VMkernel 网络适配器；</p><p>6、集群中所有主机之间的标准（非延伸）vSAN 集群的 RTT 最大为 1 毫秒；</p><p>7、vSAN包括<code>标准版</code>、<code>高级版</code>和<code>企业版</code>。高级版包括 RAID 5/6 擦除编码、去重和压缩。企业版包括加密和延伸群集功能；</p><blockquote><p><strong>双主机或三主机集群配置的限制</strong></p><p>在三主机配置中，只能通过将允许的故障数设置为 1 来允许一个主机故障。对于虚拟机数据的两个必需副本，vSAN 将各个副本保存在不同的主机上。见证对象位于第三个主机上。由于集群中的主机数量较少，因此存在以下限制：</p><ul><li><p>当某个主机出现故障时，vSAN 无法在另一个主机上重新构建数据以防止出现另一个故障。</p></li><li><p>如果主机必须进入维护模式，则vSAN无法从主机撤出数据以维持策略合规性。主机处于维护模式时，如果发生其他故障，数据会面临潜在故障或无法访问的风险。</p><p>只能使用<strong>确保数据可访问性</strong>数据撤出选项。<strong>确保数据可访问性</strong>可保证对象在数据迁移期间保持可用，但如果发生其他故障可能会面临风险。双主机或三主机集群上的 vSAN 对象不符合策略。主机退出维护模式时，将重新构建对象以确保策略合规性。</p><p>在双主机或三主机集群具有无法访问的主机或磁盘组的任何情况下，如果发生其他故障，vSAN 对象将面临变得无法访问的风险。</p></li></ul></blockquote><div class="table-container"><table><thead><tr><th>要求</th><th>描述</th></tr></thead><tbody><tr><td>ESXi 主机</td><td>确认使用的是最新版本的 ESXi。确认至少有三个配有受支持存储配置的 ESXi 主机可分配给 vSAN 集群。为达到最佳效果，请为 vSAN 集群配置四个或四个以上主机。</td></tr><tr><td>内存</td><td>确认每个主机至少具有 32 GB 内存。为获得更高的配置和更出色的性能，集群中必须至少有 32 GB 内存。</td></tr><tr><td>存储 I/O 控制器、驱动程序和固件</td><td>验证存储 I/O 控制器、驱动程序和固件版本是否已经过认证并已在 VCG 网站 (<a target="_blank" rel="noopener" href="http://www.vmware.com/resources/compatibility/search.php">http://www.vmware.com/resources/compatibility/search.php</a>) 中列出。确认该控制器配置为直通还是 RAID 0 模式。确认该控制器缓存和高级功能已禁用。如果无法禁用缓存，则必须将读取缓存设置为 100%。确认您使用的是具有较高队列深度的控制器。在维护和故障期间，使用队列深度小于 256 的控制器会显著影响您的虚拟机性能。</td></tr><tr><td>缓存和容量</td><td>确认为集群提供存储的 vSAN 主机至少有一个缓存和一个容量设备。vSAN 需要独占访问 vSAN 集群中主机的本地缓存和容量设备。它们无法与其他用途（例如，虚拟闪存文件系统 (VFFS)、VMFS 分区或 ESXi 引导分区）共享这些设备。为获得最佳效果，请创建拥有统一配置主机的 vSAN 集群。</td></tr><tr><td>网络连接</td><td>确认每个主机都至少配置有一个网络适配器。对于混合配置，确认 vSAN 主机的专用带宽至少为 1 GbE。对于全闪存配置，确认 vSAN 主机的带宽至少为 10 GbE。</td></tr><tr><td>许可证密钥</td><td>确认您拥有有效的 vSAN 许可证密钥。要使用全闪存功能，您的许可证必须支持该功能。要使用高级功能，例如延伸集群或者去重和压缩，您的许可证必须支持这些功能。确认您计划使用的许可证容量等于加入 vSAN 集群的各个主机的 CPU 总数。请勿仅为向集群提供容量的主机提供许可证容量。有关 vSAN 的许可信息，请参见《vCenter Server 和主机管理》文档。</td></tr></tbody></table></div><h2 id="2-vSAN存储设计"><a href="#2-vSAN存储设计" class="headerlink" title="2 vSAN存储设计"></a>2 vSAN存储设计</h2><p>1、闪存缓存设备与磁盘组数量之比始终为 1:1。</p><p>2、在全闪存配置中，**vSAN 不会将缓存用于读取操作(只有写缓存)**，也不会应用虚拟机存储策略中的读取缓存预留设置。对于缓存设备，您可以使用少量具有高写入持久力的成本更高的闪存。为了实现更好的 vSAN 性能，请使用更多由较小闪存容量设备组成的磁盘组。为了获得平衡的性能和可预测的行为，请使用同一类型和型号的闪存容量设备。</p><p>3、注意闪存设备的写寿命和性能分类。</p><p>4、vSAN每个主机最多5个磁盘组，每个磁盘最最大7个容量盘。</p><h3 id="2-1-集群特性"><a href="#2-1-集群特性" class="headerlink" title="2.1 集群特性"></a>2.1 集群特性</h3><p>1、每个 vCenter Server 实例可以有多个 vSAN 群集。可以使用一个 vCenter Server管理多个 vSAN 群集。</p><p>2、vSAN将占用所有设备（包括闪存缓存和容量设备），并且不会与其他功能共享设备。</p><p>3、vSAN群集可以包含具有/不具有容量设备的主机。最低要求是三个带容量设备的主机。为获得最佳效果，请创建拥有统一配置主机的 vSAN群集。</p><p>4、如果主机提供容量，则该主机必须至少具有一个闪存缓存设备和一个容量设备。</p><p>5、在混合群集中，磁盘用于提供容量，闪存设备用于提供读写缓存。vSAN 将所有可用缓存的 70% 分配为读取缓存，30% 分配为写入缓冲区。在混合配置中，闪存设备用作读取缓存和写入缓冲区。</p><p>6、在全闪存群集中，一个指定的闪存设备用作写入缓存，其他闪存设备用作容量设备。在全闪存群集中，所有读取请求都直接来自闪存池容量。只有本地容量设备或直接连接的容量设备能够加入vSAN群集。vSAN无法占用其他连接到群集的外部存储，例如 SAN 或 NAS。</p><p>7、有别于VMFS文件系统，采用vSAN的的虚拟机，文件系统为vSAN类型。</p><h3 id="2-2-配置足够的临时空间"><a href="#2-2-配置足够的临时空间" class="headerlink" title="2.2 配置足够的临时空间"></a>2.2 配置足够的临时空间</h3><p>1、==至少留有 30% 的未使用空间==，以防止vSAN重新均衡存储负载。==只要单个容量设备上的消耗达到 80% 或以上==，vSAN就会重新均衡集群中的组件。重新均衡操作可能会影响应用程序的性能。要避免这些问题，存储消耗应低于 70%。</p><p>2、规划额外容量，用于处理任何潜在故障或替换容量设备、磁盘组和主机。当某个容量设备无法访问时，vSAN会在集群中的其他设备中恢复组件。当闪存缓存设备出现故障或移除时，vSAN会从整个磁盘组中恢复组件。</p><p>3、预留额外容量以确保vSAN在出现主机故障或主机进入维护模式时恢复组件。例如，置备具有足够容量的主机，以便留有足够的可用容量以在主机出现故障或维护期间重新构建组件。存在三个以上的主机时此额外空间非常重要，这样您才有足够的可用容量来重新构建出现故障的组件。如果主机出现故障，将在其他主机的可用存储上进行重新构建，这样可以允许再次出现故障。但是，在三主机集群中，如果将<strong>允许的故障数主要级别</strong>设置为 1，则 vSAN 不会执行重新构建操作，因为在一个主机出现故障后，集群中只剩下两个主机。要允许故障后重新构建，至少必须有三个正常运行的主机。</p><p>4、提供足够的临时存储空间，以便在vSAN虚拟机存储策略中进行更改。动态更改虚拟机存储策略时，vSAN 可能会创建新的对象 RAID 树布局。vSAN 实例化和同步新布局时，对象可能会暂时占用额外的空间。在集群中保留一些临时存储空间以处理此类更改。</p><p>5、如果计划使用软件校验和或去重和压缩等高级功能，请保留额外的容量以处理操作开销</p><h3 id="2-3-vSAN控制器设计优化"><a href="#2-3-vSAN控制器设计优化" class="headerlink" title="2.3 vSAN控制器设计优化"></a>2.3 vSAN控制器设计优化</h3><p>1、如果可能，请使用多个存储控制器，这样可以改善性能并只将潜在的控制器故障隔离到磁盘组子集中。</p><p>2、使用VMware 兼容性指南中队列深度最高的存储控制器。使用具有高队列深度的控制器可提高性能。例如，在出现故障后 vSAN 重新构建组件时或者主机进入维护模式时。</p><p>3、在直通模式下使用存储控制器以实现 vSAN 的最佳性能。与处于直通模式的存储控制器相比，处于 RAID 0 模式的存储控制器需要较高的配置和维护工作量。</p><p>4、对控制器禁用缓存，或将缓存设置为 100% 读取。</p><div class="table-container"><table><thead><tr><th>存储控制器功能</th><th>存储控制器要求</th></tr></thead><tbody><tr><td>所需模式</td><td>有关控制器的所需模式（直通或 RAID 0），请查看VMware 兼容性指南中的 vSAN 要求。如果直通和 RAID 0 模式均受支持，请配置直通模式，而非 RAID 0。替换磁盘时，RAID 0 会增加复杂程度。</td></tr><tr><td>RAID 模式</td><td>如果使用 RAID 0，每个物理磁盘设备需要创建一个 RAID 卷。请勿启用VMware 兼容性指南中所列模式之外的 RAID 模式。请勿启用控制器跨越模式。</td></tr><tr><td>驱动程序和固件版本</td><td>根据VMware 兼容性指南，为控制器使用最新版本的驱动程序和固件。如果使用内置控制器驱动程序，请确认驱动程序已经过 vSAN 认证。OEM ESXi 版本可能包含未经认证且未在VMware 兼容性指南中列出的驱动程序。</td></tr><tr><td>队列深度</td><td>确认控制器的队列深度为 256 或更高。较高的队列深度能够提高性能。</td></tr><tr><td>缓存</td><td>禁用存储控制器缓存，如果不能禁用该缓存，请将其设置为 100% 读取。</td></tr><tr><td>高级功能</td><td>禁用高级功能（例如，HP SSD 智能路径）。</td></tr></tbody></table></div><blockquote><p>案例中主机型号为：DELL R740，其中控制器型号为PERC H330。这里有两种模式。Non-RAID模式或者将阵列卡设置为HBA直通模式。</p><p>另外注意：vSAN 不支持 PERC H330 控制器，且没有计划对其进行认证，详见<code>https://kb.vmware.com/s/article/2149392?lang=zh_CN</code>。生产环境中建议选择vSAN兼容的控制器。</p></blockquote><h2 id="3-vSAN设计和优化"><a href="#3-vSAN设计和优化" class="headerlink" title="3 vSAN设计和优化"></a>3 vSAN设计和优化</h2><p>1、全闪存配置，请安排具有专用或共享 10-GbE 适配器的主机。</p><p>2、如果 10-GbE 适配器与其他流量类型共享，请使用 vSphere Distributed Switch 以便 vSAN 流量通过使用 Network I/O Control 和 VLAN 隔离流量。为 vSAN 流量创建物理适配器组以确保冗余。</p><p>3、如果闪存缓存或存储控制器停止响应，则整个磁盘组可能出现故障。因此，vSAN 会从群集中的其他位置重新构建故障磁盘组的所有组件。<strong>建议使用多个磁盘组</strong>。</p><blockquote><ul><li>优点<ul><li>因为数据存储具有更多汇总缓存并且 I/O 操作更快，所以提高了性能。</li><li>故障风险分散到多个磁盘组。</li><li>如果磁盘组出现故障，则 vSAN 重新构建较少的组件，因此提高了性能。</li></ul></li><li>劣势<ul><li>因为需要两个或更多缓存设备，成本增加。</li><li>需要更多内存来处理更多磁盘组。</li><li>需要多个存储控制器来降低单点故障风险。</li></ul></li></ul></blockquote><p>4、设备热插拔和交互</p><p><strong>考虑使用存储控制器直通模式支持，以轻松实现主机上的磁盘和闪存容量设备的热插拔或更换。如果控制器适用于 RAID 0 模式，必须执行其他步骤才可以使主机发现新驱动器。</strong></p><h2 id="4-vSAN集群的设计注意事项"><a href="#4-vSAN集群的设计注意事项" class="headerlink" title="4 vSAN集群的设计注意事项"></a>4 vSAN集群的设计注意事项</h2><p>设计主机和管理节点的配置，以获得最佳可用性并允许消耗增长。</p><h3 id="4-1-调整vSAN集群的大小以允许故障"><a href="#4-1-调整vSAN集群的大小以允许故障" class="headerlink" title="4.1 调整vSAN集群的大小以允许故障"></a>4.1 调整vSAN集群的大小以允许故障</h3><p>可以在虚拟机存储策略中配置<strong>允许的故障数主要级别</strong> (PFTT) 属性以处理主机故障。集群所需的主机数计算方式为：<code>2 * PFTT + 1</code>。集群所配置允许的故障越多，所需的容量主机越多。</p><p>如果在机架服务器中连接集群主机，可以将主机整理到故障域以提高机架顶部交换机故障和服务器机架断电等问题的应对能力。请参见<a target="_blank" rel="noopener" href="https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.vsphere.vsan-planning.doc/GUID-FE7DBC6F-C204-4137-827F-7E04FE88D968.html#GUID-FE7DBC6F-C204-4137-827F-7E04FE88D968">设计和优化 vSAN 故障域</a>。</p><h3 id="4-2-双主机或三主机集群配置的限制"><a href="#4-2-双主机或三主机集群配置的限制" class="headerlink" title="4.2 双主机或三主机集群配置的限制"></a>4.2 双主机或三主机集群配置的限制</h3><p>在三主机配置中，只能通过将允许的故障数设置为 1 来允许一个主机故障。对于虚拟机数据的两个必需副本，vSAN 将各个副本保存在不同的主机上。见证对象位于第三个主机上。由于集群中的主机数量较少，因此存在以下限制：</p><ul><li><p>当某个主机出现故障时，vSAN 无法在另一个主机上重新构建数据以防止出现另一个故障。</p></li><li><p>如果主机必须进入维护模式，则vSAN无法从主机撤出数据以维持策略合规性。主机处于维护模式时，如果发生其他故障，数据会面临潜在故障或无法访问的风险。</p><p>只能使用<strong>确保数据可访问性</strong>数据撤出选项。<strong>确保数据可访问性</strong>可保证对象在数据迁移期间保持可用，但如果发生其他故障可能会面临风险。双主机或三主机集群上的 vSAN 对象不符合策略。主机退出维护模式时，将重新构建对象以确保策略合规性。</p><p>在双主机或三主机集群具有无法访问的主机或磁盘组的任何情况下，如果发生其他故障，vSAN 对象将面临变得无法访问的风险。</p></li></ul><h3 id="4-3-平衡和不平衡的集群配置"><a href="#4-3-平衡和不平衡的集群配置" class="headerlink" title="4.3 平衡和不平衡的集群配置"></a>4.3 平衡和不平衡的集群配置</h3><p>vSAN 最适合在具有统一配置（包括存储配置）的主机上运行。</p><p>如果 vSAN 集群使用具有不同配置的主机，则会存在以下劣势：</p><ul><li>存储性能的可预测性将会降低，因为 vSAN 不会在各个主机上存储相同数量的组件。</li><li>维护步骤不同。</li><li>对于集群中拥有较少或类型不同的缓存设备的主机，性能将会降低。</li></ul><h3 id="4-4-在-vSAN-上部署-vCenter-Server"><a href="#4-4-在-vSAN-上部署-vCenter-Server" class="headerlink" title="4.4 在 vSAN 上部署 vCenter Server"></a>4.4 在 vSAN 上部署 vCenter Server</h3><p>如果 vCenter Server 变得不可用，vSAN 将继续正常工作，且虚拟机继续运行。</p><p>如果 vCenter Server 部署在 vSAN 数据存储中，则 vSAN 集群发生问题时，可以使用 Web 浏览器通过 vSphere Host Client 访问每个 ESXi 主机并监控 vSAN。vSAN 运行状况信息显示在 Host Client 中，也可以通过 esxcli 命令查看。</p><h2 id="5-vSAN-网络"><a href="#5-vSAN-网络" class="headerlink" title="5 vSAN 网络"></a>5 vSAN 网络</h2><p>实际上vSphere网络配置看上去很复杂，包括端口组、分布式交换机、标准交换机等等。</p><p>网络类型从某种程度上说包括vSAN网络和非vSAN网络。</p><p>我们这里接来下配置的基于vSAN需求的vSAN网络，推荐采用分布式交换机进行实施，生产环境下需要用多网卡进行链路聚合，上联物理交换机采用采用双机跨链路聚合进行，M_lag的优势不在此进行阐述。</p><p>先说明几点vSAN网络的基本概念，然后在《8 vSAN网络部署》中详细说明。</p><h3 id="5-1-网络故障切换和负载均衡"><a href="#5-1-网络故障切换和负载均衡" class="headerlink" title="5.1 网络故障切换和负载均衡"></a>5.1 网络故障切换和负载均衡</h3><p>vSAN 使用在仅用于网络冗余的后备虚拟交换机上配置的绑定和故障切换策略</p><p>vSAN 不会将网卡绑定用于负载均衡 。如果计划为可用性配置网卡成组，请考虑这些故障切换配置。</p><div class="table-container"><table><thead><tr><th>成组算法</th><th>组中适配器的故障切换配置</th></tr></thead><tbody><tr><td>基于源虚拟端口的路由</td><td>主动/被动</td></tr><tr><td>基于 IP 哈希的路由</td><td>主动/主动，静态 EtherChannel 用于标准交换机，LACP 端口通道用于分布式交换机</td></tr><tr><td>基于物理网络适配器负载的路由</td><td>主动/主动</td></tr></tbody></table></div><p>注意这里的<code>静态 EtherChannel 用于标准交换机，LACP 端口通道用于分布式交换机</code></p><p>后续采用分布式交换机建立LACP，物理交换机采用M_lag跨设备的链路聚合实现vSAN网络的高可用性。</p><h3 id="5-2-使用-Network-I-O-Control-为-vSAN-分配带宽"><a href="#5-2-使用-Network-I-O-Control-为-vSAN-分配带宽" class="headerlink" title="5.2 使用 Network I/O Control 为 vSAN 分配带宽"></a>5.2 使用 Network I/O Control 为 vSAN 分配带宽</h3><p>vSAN 流量可以与其他系统流量类型（例如 vSphere vMotion 流量、vSphere HA 流量和虚拟机流量）共享 10-GbE 物理网络适配器。要保证 vSAN 所需带宽的大小，请使用 vSphere Distributed Switch 中的 vSphere Network I/O Control。</p><p>在 vSphere Network I/O Control 中，您可以为 vSAN 出站流量配置预留和份额。</p><ul><li>设置预留以便 Network I/O Control 保证 vSAN 的物理适配器可用的最小带宽。</li><li>设置份额以便当分配给 vSAN 的物理适配器变成饱和状态时，vSAN 仍有特定带宽可用并且防止 vSAN 在重新构建和同步操作期间占用物理适配器的全部容量。例如，当组中其他物理适配器出现故障且端口组中所有流量被转移到组中其他适配器时，物理适配器可能变成饱和状态。</li></ul><p>例如，在处理 vSAN、vSphere vMotion 和虚拟机流量的 10-GbE 物理适配器上，您可以配置特定带宽和份额。</p><div class="table-container"><table><thead><tr><th>流量类型</th><th>预留，Gbps</th><th>份额</th></tr></thead><tbody><tr><td>vSAN</td><td>1</td><td>100</td></tr><tr><td>vSphere vMotion</td><td>0.5</td><td>70</td></tr><tr><td>虚拟机</td><td>0.5</td><td>30</td></tr></tbody></table></div><p>如果 10-GbE 适配器变成饱和状态，Network I/O Control 将分配 5 Gbps 到物理适配器上的 vSAN。</p><h3 id="5-3-vSAN网络最佳实践"><a href="#5-3-vSAN网络最佳实践" class="headerlink" title="5.3 vSAN网络最佳实践"></a>5.3 vSAN网络最佳实践</h3><p>1、对于混合配置，请专门使用至少 1 GbE 的物理网络适配器。若要获得最佳网络性能，请将 vSAN 流量放置于专用的或共享的 10-GbE 物理适配器上。</p><p>2、对于全闪存配置，请使用专用的或共享的 10-GbE 物理网络适配器。</p><p>3、置备一个附加物理网卡作为故障切换网卡。</p><p>4、如果您使用了共享的 10-GbE 网络适配器，请将 vSAN 流量置于 Distributed Switch 上，然后配置 Network I/O Control 以保证 vSAN 的带宽。</p><p>5、生产环境下，vMotion、vSAN将流量进行隔离，跟别创建不同的分布式交换机。后续业务和管理的网络也都进行物理隔离。</p><h2 id="6-vSAN部署步骤"><a href="#6-vSAN部署步骤" class="headerlink" title="6 vSAN部署步骤"></a>6 vSAN部署步骤</h2><p><strong>vSAN部署步骤包括</strong></p><p>1、先创建vSAN网络，采用分布式交换机</p><p>2、添加管理主机</p><p>3、如果要做上行链路的聚合，要先添加LACP组</p><p>4、添加vmkernel，vmkernel启用vSAN功能，添加上行链路(结合LACP端口组)</p><p>5、申明磁盘，注意这里如果磁盘有分区，需要进行清除分区操作。</p><h2 id="7-vSAN网络部署"><a href="#7-vSAN网络部署" class="headerlink" title="7 vSAN网络部署"></a>7 vSAN网络部署</h2><h3 id="7-1-新建分布式交换机"><a href="#7-1-新建分布式交换机" class="headerlink" title="7.1 新建分布式交换机"></a>7.1 新建分布式交换机</h3><p>分布式交换机的好处在于，大大降低了部署的步骤，减少在各主机上进行创建标准交换机的工作量。</p><p>开始部署</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022313721.png" alt="image-20210610083835506"></p><p>输入名称</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022312421.png" alt="image-20240402231220360"></p><p>选择分布式版本7.0.2版本。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022314230.png" alt="image-20210610083953325"></p><p>使用 Distributed Switch 上的 vSphere Network I/O Control 为 vSAN 预留带宽。</p><p>端口组名称为<code>vSAN-DPortGroup</code></p><p>将 vSAN 的物理适配器作为活动上行链路分配给该端口组。这里选择2个上行链路作为冗余。</p><p>这里使用2块网卡组来实现网络可用性，物联交换机需要配置合适链路聚合配置来实现匹配。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022314737.png" alt="img"></p><p>注意查看系统提示的==建议的后续操作==</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022314294.png" alt="image-20210610084135750"></p><p>————-应该先添加LACP组后再添加———–</p><blockquote><p>注：如果不用LACP端口聚合，这里可以“直接添加和管理主机”。</p><p>如果需要配置LACP端口聚合，先按照<code>7.4 链路聚合部署 章节</code></p><p>两者之间的区别，就是在<code>配置上行链路</code>的区别，后者的上行链路是虚拟配置的LACP端口组。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022315605.png" alt="image-20210328211137599"></p><p>在分布式交换机上添加和管理主机</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022315009.png" alt="image-20210328211202709"></p><p>选择参与vSAN网络的主机</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022315549.png" alt="image-20210328211220736"></p><h3 id="7-2-添加和管理主机"><a href="#7-2-添加和管理主机" class="headerlink" title="7.2 添加和管理主机"></a>7.2 添加和管理主机</h3><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022315710.png" alt="image-20210328211229185"></p><p>这里很重要，需要分配上行链路（如果采用LACP此处不看）。</p><blockquote><p>提醒：需要管理员提前记录下各网卡的名称和序号。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022316897.png" alt="image-20210328211504049"></p><p>网络规划中最佳时间，vSAN网络、vMotion以及管理网络都是分开的。（如果采用LACP此处不看）</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022316602.png" alt="image-20210328211635623"></p><p>——从这里开始，无论是否采取端口聚合，均按照后续操作设置———</p><p>添加VMkernel网络适配器</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022316585.png" alt="image-20210328211722856"></p><p>不迁移虚拟网络</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022316017.png" alt="image-20210328211736775"></p><p>完成设置。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022316878.png" alt="image-20210328211807408"></p><h3 id="7-3-添加VMkernel适配器"><a href="#7-3-添加VMkernel适配器" class="headerlink" title="7.3 添加VMkernel适配器"></a>7.3 添加VMkernel适配器</h3><p>注意是对端口组<code>vSAN-DPortGroup</code>进行操作</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022317850.png" alt="image-20210328212304021"></p><p>选择主机</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022317515.png" alt="image-20210328212329802"></p><p>配置VMkernel适配器</p><p>这里要注意，务必要启用<code>vSAN</code>。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022317703.png" alt="image-20210328212357274"></p><p>7.0.2版本增加了<code>vSphere Backup NFS</code>功能</p><p>7.0.3版本增加</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022317223.png" alt="image-20220903093859755"></p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022318812.png" alt="image-20210610092207494"></p><p>配置<code>IPv4</code>设置。</p><p>这里的IP地址是存储专网的私有地址，请提前合理规划好。</p><p>存储网与管理网、业务网进行物理隔离，真正的生产环境vMotion网络也要物理隔离。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022318021.png" alt="image-20210328212453135"></p><p>配置完成后，可以在主机的配置中的虚拟交换机进行查看验证(图1)。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022318400.png" alt="image-20210328212615628"></p><p>如果上行链路采用链路聚合，必须配置LACP。下图配置无法满足功能。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022318066.png" alt="image-20210329075812659"></p><h3 id="7-4-链路聚合部署"><a href="#7-4-链路聚合部署" class="headerlink" title="7.4 链路聚合部署"></a>7.4 链路聚合部署</h3><blockquote><p><strong>LACP配置主动模式和被动模式之间的区分是什么？</strong></p><p>活动-端口将通过开始协商和发送LACP帧来主动协商链路状态</p><p>被动-端口处于被动状态，且将在LACP协商期间响应发送的LACP帧</p></blockquote><p>如果是选择LACP的方式。</p><blockquote><p>注：vSAN和华为M_LAG的对接，这里走了很多弯路</p><p>某一晚参考了官网资料</p><p><a target="_blank" rel="noopener" href="https://docs.vmware.com/cn/VMware-vSphere/7.0/vsan-network-design-guide/GUID-5DEF613E-9FBD-45E1-A01B-C3E5977EDD5A.html">https://docs.vmware.com/cn/VMware-vSphere/7.0/vsan-network-design-guide/GUID-5DEF613E-9FBD-45E1-A01B-C3E5977EDD5A.html</a></p><p>第二天一早10分钟搞定。</p></blockquote><p><strong>第一个关键点来了。</strong></p><p>先创建LACP，然后再添加主机。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022318209.png" alt="image-20210407075350423"></p><p>选择相关配置，新建链路聚合组</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022319937.png" alt="image-20210610084803118"></p><p>需要对端口组进行设置【下图是7.0.2版本】，详细设置和测试详见<code>7.5 章节 vSAN网络验证</code></p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022319210.png" alt="image-20210610090740532"></p><p>此时LACP建立完成后，跳转到<code>7.2 添加和管理主机 章节</code></p><p>LACP建立后，上行链路的名称会发生变化。注意看图示内容。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022319509.png" alt="image-20210407075431114"></p><p>重新分配上行了线路，注意和<code>《7.2 添加和管理主机》</code>进行对比。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022320619.png" alt="image-20210407075559044"></p><p>添加VMkernel适配器，配置IPv4设置</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022320002.png" alt="image-20210407080357523"></p><h3 id="7-5-vSAN网络验证"><a href="#7-5-vSAN网络验证" class="headerlink" title="7.5 vSAN网络验证"></a>7.5 vSAN网络验证</h3><p>注意，此时打开任一主机的SSH服务，登录后去ping其他主机存储ipv4地址，是无法访问的。</p><p>接下来需要做负载平衡进一步设置。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022320749.png" alt="image-20210407080948291"></p><table><tbody><tr><td><pre><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br></pre></td><td><pre><span>[root@localhost:~] ping 10.10.10.51</span><br><span>PING 10.10.10.51 (10.10.10.51): 56 data bytes</span><br><span></span><br><span>--- 10.10.10.51 ping statistics ---</span><br><span>1 packets transmitted, 0 packets received, 100% packet loss</span><br></pre></td></tr></tbody></table><p><strong>第二个关键点来了。</strong></p><p>分配 LAG 组作为分布式端口组绑定和故障切换策略上的<strong>活动上行链路</strong>。</p><p>编辑端口组，并配置绑定和故障切换策略以反映新的 LAG 配置。</p><p>确保 LAG 组 <strong>lag1</strong> 位于活动上行链路位置，并确保其余上行链路处于<strong>未使用</strong>位置。</p><blockquote><p><strong>注：</strong>选择链路聚合组 (LAG) 作为唯一的活动上行链路时，LAG 的负载均衡 模式将覆盖端口组的负载均衡 模式。因此，以下策略不会起到任何作用： <strong>基于源虚拟端口的路由</strong>。</p></blockquote><p>进入编辑设置</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022320665.png" alt="image-20210610090330966"></p><p>进行编辑设置</p><blockquote><p>在 IP 哈希负载均衡策略中，连接到活动上行链路的所有物理交换机端口都必须采用链路聚合模式。</p><p>应为使用同一上行链路集的所有端口组设置 IP 哈希负载均衡。</p><p>当选择链路聚合组 (LAG) 作为唯一的活动上行链路时，LAG 的负载均衡模式将替代端口组的负载均衡模式。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022321922.png" alt="image-20210407081351518"></p><blockquote><p>注：由于 LACP 不支持信标探测，因此网络故障检测值将保留 <strong>仅链路状态</strong></p></blockquote><p>验证【注意看图片中的time的延迟毫秒数，可以看出数据中心级交换机的威力】</p><table><tbody><tr><td><pre><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br></pre></td><td><pre><span>[root@localhost:~] ping 10.10.10.51</span><br><span>PING 10.10.10.51 (10.10.10.51): 56 data bytes</span><br><span>64 bytes from 10.10.10.51: icmp_seq=0 ttl=64 time=0.106 ms</span><br><span></span><br><span>--- 10.10.10.51 ping statistics ---</span><br><span>1 packets transmitted, 1 packets received, 0% packet loss</span><br><span>round-trip min/avg/max = 0.106/0.106/0.106 ms</span><br><span></span><br><span>[root@localhost:~] ping 10.10.10.52</span><br><span>PING 10.10.10.52 (10.10.10.52): 56 data bytes</span><br><span>64 bytes from 10.10.10.52: icmp_seq=0 ttl=64 time=0.130 ms</span><br><span>64 bytes from 10.10.10.52: icmp_seq=1 ttl=64 time=0.101 ms</span><br><span></span><br><span>--- 10.10.10.52 ping statistics ---</span><br><span>2 packets transmitted, 2 packets received, 0% packet loss</span><br><span>round-trip min/avg/max = 0.101/0.116/0.130 ms</span><br></pre></td></tr></tbody></table><p><strong>相关的配置具体缺一不可。</strong></p><p>进一步查看分布式交换机的拓扑结构。</p><p>注意和《7.4 链路聚合部署》图1做进一步比较</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022321102.png" alt="image-20210407082008501"></p><h3 id="7-6-物理交换机的跨设备链路聚合配置"><a href="#7-6-物理交换机的跨设备链路聚合配置" class="headerlink" title="7.6 物理交换机的跨设备链路聚合配置"></a>7.6 物理交换机的跨设备链路聚合配置</h3><p>M-LAG（Multichassis Link Aggregation Group）即跨设备链路聚合组，是一种实现跨设备链路聚合的机制，将一台设备与另外两台设备进行跨设备链路聚合，从而把链路可靠性从单板级提高到了设备级。</p><p>对二层来讲，可将M-LAG理解为一种横向虚拟化技术，将M-LAG的两台设备在逻辑上虚拟成一台设备，形成一个统一的二层逻辑节点。M-LAG提供了一个没有环路的二层拓扑同时实现冗余备份，不再需要繁琐的生成树协议配置，极大的简化了组网及配置。这种设计相对传统的xSTP破环保护，逻辑拓扑更加清晰、链路利用更加高效。</p><p>M-LAG技术本质上还是控制平面虚拟化技术，但是和堆叠技术不同的是，由于M-LAG的目的仅仅是在链路聚合协商时，对外表现出同样的状态，所以不需要像堆叠那样同步设备上所有的信息，只需要同步接口和表项相关的一些内容。</p><p>M-LAG主要的应用场景是“双归接入”，即用户侧设备双归接入到两台接入设备上，这个场景下传统的技术主要有堆叠、Smart-Link等技术。但这些技术都有缺点： 堆叠两台（或多台）使用的是一个控制面，单点故障可能会影响到整个系统，在升级的时候表现尤其突出。</p><p>【交换机配置】</p><p>这里以存储网的设置为例，存储网用于三个服务器节点的vSAN存储专网的流量转发。</p><p>vlan id为11，两台交换机的<code>10GE 1/0/1</code>、<code>10GE 1/0/2</code>、<code>10GE 1/0/3</code>分别作为三台Esxi节点存储网口的跨设备链路聚合，作为同一组dfs group的不同成员。</p><p><code>40GE1/0/1</code>和<code>40GE1/0/2</code>作为两台交换机的<code>peer-link</code>通讯</p><p>【交换机1配置】</p><table><tbody><tr><td><pre><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br></pre></td><td><pre><span>交换机1配置</span><br><span>1 配置管理口地址</span><br><span>interface MEth0/0/0</span><br><span>ip address 192.168.100.181 255.255.255.0</span><br><span>vlan batch 11</span><br><span></span><br><span>2 将管理口地址用于M-LAG主备设备间心跳报文的传输，交换机1 优先级150</span><br><span>dfs-group 1</span><br><span>priority 150</span><br><span><span>source</span> ip 192.168.100.181</span><br><span></span><br><span>3 配置peer-link，将40G链路进行绑定作为两台交换机之间的peer-link通讯</span><br><span>interface Eth-Trunk0</span><br><span>trunkport 40GE1/0/1</span><br><span>trunkport 40GE1/0/2</span><br><span>mode lacp-static </span><br><span>peer-link 1</span><br><span></span><br><span>4 配置m-lag成员组，用于接入Esxi节点1存储网口</span><br><span>interface Eth-Trunk20</span><br><span>port default vlan 11</span><br><span>mode lacp-static</span><br><span>dfs-group 1 m-lag 1</span><br><span>trunkport 10GE 1/0/1</span><br><span> </span><br><span>5 配置m-lag成员组，用于接入Esxi节点3存储网口</span><br><span>interface Eth-Trunk21</span><br><span>port default vlan 11</span><br><span>mode lacp-static</span><br><span>dfs-group 1 m-lag 2</span><br><span>trunkport 10GE 1/0/2</span><br><span> </span><br><span>6 配置m-lag成员组，用于接入Esxi节点3存储网口</span><br><span>interface Eth-Trunk22</span><br><span>port default vlan 11</span><br><span>mode lacp-static</span><br><span>dfs-group 1 m-lag 3</span><br><span>trunkport 10GE 1/0/3</span><br></pre></td></tr></tbody></table><p>【交换机2配置】</p><p>【注意交换机2的管理地址为192.168.100.182】</p><table><tbody><tr><td><pre><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br><span>18</span><br><span>19</span><br><span>20</span><br><span>21</span><br><span>22</span><br><span>23</span><br><span>24</span><br><span>25</span><br><span>26</span><br><span>27</span><br><span>28</span><br><span>29</span><br><span>30</span><br><span>31</span><br><span>32</span><br><span>33</span><br><span>34</span><br><span>35</span><br><span>36</span><br><span>37</span><br><span>38</span><br></pre></td><td><pre><span>交换机2配置</span><br><span>1 配置管理口地址</span><br><span>interface MEth0/0/0</span><br><span>ip address 192.168.100.182 255.255.255.0</span><br><span>vlan batch 11</span><br><span></span><br><span>2 将管理口地址用于M-LAG主备设备间心跳报文的传输，交换机2 优先级120</span><br><span>dfs-group 1</span><br><span>priority 120</span><br><span><span>source</span> ip 192.168.100.182</span><br><span></span><br><span>3 配置peer-link，将40G链路进行绑定作为两台交换机之间的peer-link通讯</span><br><span>interface Eth-Trunk0</span><br><span>trunkport 40GE1/0/1</span><br><span>trunkport 40GE1/0/2</span><br><span>mode lacp-static </span><br><span>peer-link 1</span><br><span></span><br><span>4 配置m-lag成员组，用于接入Esxi节点1存储网口</span><br><span>interface Eth-Trunk20</span><br><span>port default vlan 11</span><br><span>mode lacp-static</span><br><span>dfs-group 1 m-lag 1</span><br><span>trunkport 10GE 1/0/1</span><br><span> </span><br><span>5 配置m-lag成员组，用于接入Esxi节点2存储网口</span><br><span>interface Eth-Trunk21</span><br><span>port default vlan 11</span><br><span>mode lacp-static</span><br><span>dfs-group 1 m-lag 2</span><br><span>trunkport 10GE 1/0/2</span><br><span> </span><br><span>6 配置m-lag成员组，用于接入Esxi节点3存储网口</span><br><span>interface Eth-Trunk22</span><br><span>port default vlan 11</span><br><span>mode mlacp-static</span><br><span>dfs-group 1 m-lag 3</span><br><span>trunkport 10GE 1/0/3</span><br></pre></td></tr></tbody></table><p>配置完成后，进行LACP验证。</p><p>LACP验证【可以看出lacp的协议包开始发送和接受】</p><table><tbody><tr><td><pre><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br></pre></td><td><pre><span>交换机1</span><br><span></span><br><span>[~leaf-1]display lacp statistics eth-trunk 20</span><br><span> Eth-Trunk20<span>'s PDU statistics is:</span></span><br><span><span> -------------------------------------------------------------------------------</span></span><br><span><span> Port                       LacpRevPdu  LacpSentPdu  MarkerRevPdu  MarkerSentPdu</span></span><br><span><span> 10GE1/0/1                          58       165644             0              0</span></span><br><span><span></span></span><br><span><span>交换机2</span></span><br><span><span>&lt;leaf_2</span></span><br><span><span> Eth-Trunk20'</span>s PDU statistics is:</span><br><span> -------------------------------------------------------------------------------</span><br><span> Port                       LacpRevPdu  LacpSentPdu  MarkerRevPdu  MarkerSentPdu</span><br><span> 10GE1/0/1                          55        62547             0              0</span><br></pre></td></tr></tbody></table><p>继续查看m-lag组成员端口状态，均为<code>active(*)-active</code></p><table><tbody><tr><td><pre><span>1</span><br><span>2</span><br><span>3</span><br><span>4</span><br><span>5</span><br><span>6</span><br><span>7</span><br><span>8</span><br><span>9</span><br><span>10</span><br><span>11</span><br><span>12</span><br><span>13</span><br><span>14</span><br><span>15</span><br><span>16</span><br><span>17</span><br></pre></td><td><pre><span>交换机1</span><br><span>[~leaf-1]display dfs-group 1 node 1 m-lag brief</span><br><span>* - Local node</span><br><span></span><br><span>M-Lag ID     Interface      Port State    Status                Consistency-check</span><br><span>       1     Eth-Trunk 20   Up            active(*)-active      --                       </span><br><span>       2     Eth-Trunk 21   Up            active(*)-active      --                       </span><br><span>       3     Eth-Trunk 22   Up            active(*)-active      --</span><br><span></span><br><span></span><br><span>[~leaf_2]display dfs-group 1 node 1 m-lag brief</span><br><span>* - Local node</span><br><span></span><br><span>M-Lag ID     Interface      Port State    Status</span><br><span>       1     Eth-Trunk 20   Up            active-active(*)</span><br><span>       2     Eth-Trunk 21   Up            active-active(*)</span><br><span>       3     Eth-Trunk 22   Up            active-active(*)</span><br></pre></td></tr></tbody></table><p>——至此，分布式交换机配置完成。—–</p><h2 id="8-vSAN部署"><a href="#8-vSAN部署" class="headerlink" title="8 vSAN部署"></a>8 vSAN部署</h2><h3 id="8-1-启用vSAN"><a href="#8-1-启用vSAN" class="headerlink" title="8.1 启用vSAN"></a>8.1 启用vSAN</h3><p>vSAN集群功能有几个操作入口</p><p>一是右键集群的右键菜单。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022321433.png" alt="image-20210611122552505"></p><p>二是通过配置集群的服务。</p><blockquote><p>在vSAN最好通过<code>7.5 章节中vSAN网络验证</code>进行测试，先排除网络故障等原因，方便后续部署。</p></blockquote><p>vSAN网络部署完毕后，开始建立vSAN集群。</p><p>vSAN配置的入口详见下图。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022321415.png" alt="image-20210610120516802"></p><p>vSAN类型包括：单站点集群、双主机及延伸集群。</p><p>我们这里选择单站点集群类型。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022322417.png" alt="image-20210407083015851"></p><p>7.0.2版本，增加了<code>具有自定义故障域的单站点集群</code>和<code>vSAN HCI网络计算集群</code>两种类型。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022322441.png" alt="image-20210610120611546"></p><p>去重和压缩功能，仅在高级版本和企业版本中能够启用。</p><blockquote><p>在使用全闪存配置时，闪存设备将提供_容量_。</p><p>对于混合配置，磁盘将计入_容量_。部分容量将分配给元数据。</p><p>对于磁盘格式版本 1.0，每个_容量_设备会增加约 1 GB。</p><p>磁盘格式版本 2.0 会增加_容量_开销，通常每个设备不超过 1-2% 的_容量_。</p><p>磁盘格式 _3_.0 及更高版本会增加_容量_开销，通常每个设备不超过 1-2% 的_容量_。</p><p>如果启用去重和压缩功能以及软件校验和，则每个设备需要约 _6_.2% _容量_的额外开销。</p></blockquote><p>我们这里选择去重和压缩。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022322393.png" alt="image-20210407083147620"></p><p>如果是超过32个节点，启用<code>大规模集群支持</code>选项。</p><p>从下图可以看出如果没有选择缓存盘，集群无法正常建立。</p><blockquote><p>全闪的vSAN集群中，==缓存盘只是写缓存==，不需要读缓存功能。</p><p>全闪的vSAN集群是没有读缓存的。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022322317.png" alt="image-20210407085835319"></p><p>正确的设置是设置1个缓存盘，剩余全部为容量盘。</p><p>再次强调一点。vSAN集群中每个主机最多设置5个磁盘组，每个磁盘组设置最多7个容量盘。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022323474.png" alt="image-20210407085854430"></p><p>创建故障域，这里先不创建。</p><p>关于故障域的解释详见官网资料。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022323893.png" alt="image-20210407091015140"></p><p>最终的相关设置</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022323080.png" alt="image-20210407091137274"></p><p>设置完成后，系统开始进行配置、更新vSAN配置。</p><p>开始创建VSAN</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022324357.png" alt="image-20210407091224604"></p><p>———–至此，VSan配置完成。———</p><h3 id="8-2-许可证"><a href="#8-2-许可证" class="headerlink" title="8.2 许可证"></a>8.2 许可证</h3><p>vSAN集群完成后分配许可证</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022324840.png" alt="image-20210611123310657"></p><h3 id="8-3-功能验证"><a href="#8-3-功能验证" class="headerlink" title="8.3 功能验证"></a>8.3 功能验证</h3><p>我们可以查看某一个ESXi节点的磁盘组，发现设计内的4组SSD磁盘，其中一个用于写缓存，三个用于容量盘。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022324581.png" alt="image-20210412153047940"></p><p>查看故障域情况</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022324158.png" alt="image-20210412152918953"></p><p>查看默认的vSAN存储策略</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022324631.png" alt="image-20210412153825117"></p><p>编辑查看vSAN的存储策略</p><p>高可用性设置，可以看出默认的故障数为1，也可以设置为RAID5(纠删码形式)。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022324624.png" alt="image-20210412154040951"></p><p>高级策略规则</p><p>这里默认的<code>对象空间预留</code>为<code>精简置备</code>。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022325787.png" alt="image-20210412154839212"></p><p>我们建立一个虚拟机，可以看出默认的磁盘类型就是匹配了这个默认的vSAN的存储策略。</p><blockquote><p>目前三节点的vSAN集群，采用的是双副本策略，因此存储消耗即为200G。</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022325087.png" alt="image-20210412155911227"></p><p>我们新建一个虚拟机，可以看出由于vSAN磁盘存储是RAID-1模式</p><p>这个<code>LDAP_Server</code>的物理磁盘位置分别位于<code>192.168.100.51</code>和<code>192.168.100.52</code>两个磁盘上，其中<code>192.168.100.50</code>作为见证方防止脑裂。</p><blockquote><p>因此可以看出来，任何一个主机出现故障，虚拟机均不会出现问题，这也是允许的故障数为1的原因</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022325624.png" alt="image-20210412160256463"></p><h2 id="9-其他几个常见问题"><a href="#9-其他几个常见问题" class="headerlink" title="9 其他几个常见问题"></a>9 其他几个常见问题</h2><h3 id="9-1-获取最新的-HCL-数据库版本"><a href="#9-1-获取最新的-HCL-数据库版本" class="headerlink" title="9.1 获取最新的 HCL 数据库版本"></a>9.1 获取最新的 HCL 数据库版本</h3><p>下载<a target="_blank" rel="noopener" href="http://partnerweb.vmware.com/service/vsan/all.json">http://partnerweb.vmware.com/service/vsan/all.json</a></p><p>离线更新</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022325229.png" alt="image-20210407161718668"></p><h3 id="9-2-时间同步"><a href="#9-2-时间同步" class="headerlink" title="9.2 时间同步"></a>9.2 时间同步</h3><p>访问Vcenter管理界面</p><p><a target="_blank" rel="noopener" href="https://vcenter7.vmware7.cj.io:5480/#/">https://vcenter7.vmware7.cj.io:5480/#/</a></p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022326800.png" alt="image-20210407162947575"></p><p>配置主机的时间</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022328268.png" alt="image-20210407163024231"></p><p>验证</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022328609.png" alt="image-20210407162902058"></p><h3 id="9-3-下载最新的-vSAN-版本目录"><a href="#9-3-下载最新的-vSAN-版本目录" class="headerlink" title="9.3 下载最新的 vSAN 版本目录"></a>9.3 下载最新的 vSAN 版本目录</h3><blockquote><p>针对 vSphere Lifecycle Manager 的 vSAN 内部版本建议</p><p><a target="_blank" rel="noopener" href="https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.vsphere.vsan.doc/GUID-E87F7946-1EDE-45EE-9087-823F7E61FABF.html">https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.vsphere.vsan.doc/GUID-E87F7946-1EDE-45EE-9087-823F7E61FABF.html</a></p></blockquote><p>下载最新的vSAN版本目录文件</p><p><a target="_blank" rel="noopener" href="https://vcsa.vmware.com/ph/api/v1/results?deploymentId=tba4919b-2dce-f4585-9556-a780bb9ac060&amp;collectorId=VsanCloudHealth.6_5&amp;objectId=0c3e9009-ba5d-4e5f6-bae8-f25ec506d219&amp;type=vsan-updates-json">https://vcsa.vmware.com/ph/api/v1/results?deploymentId=tba4919b-2dce-f4585-9556-a780bb9ac060&amp;collectorId=VsanCloudHealth.6_5&amp;objectId=0c3e9009-ba5d-4e5f6-bae8-f25ec506d219&amp;type=vsan-updates-json</a></p><p>离线更新后可以解决很多告警，包括SCSI控制器兼容性问题</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022329456.png" alt="image-20210407164741266"></p><blockquote><p>图示里红色的是，在配置 vSphere HA过程中，地址配置不正确</p><p>系统提示：“该主机不具有按 vSphere HA 要求定义的隔离地址”</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022329902.png" alt="image-20210407092824614"></p><h3 id="9-4-重新设置vSAN配置出现的已有分区报错"><a href="#9-4-重新设置vSAN配置出现的已有分区报错" class="headerlink" title="9.4 重新设置vSAN配置出现的已有分区报错"></a>9.4 重新设置vSAN配置出现的已有分区报错</h3><p>之前分区如果没有被清除分区，直接再重新进行vSAN的配置，会出现报错</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022329135.png" alt="image-20210610121703907"></p><p>需要对磁盘进行清除分区操作。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022329993.png" alt="image-20210610121836491"></p><h3 id="9-5-序列号"><a href="#9-5-序列号" class="headerlink" title="9.5 序列号"></a>9.5 序列号</h3><blockquote><p>vSphere 7 Enterprise Plus with Add-on for kubernetes</p><p>5C680-4EL12-085H8-R10QH-23R3A</p><p>vCenter Server 7 Standard</p><p>1Z4MA-6J297-485D9-JV8Q4-2K076</p><p>vSAN Enterprise Plus</p><p>HV00U-2UJDP-M85H1-UR15P-CUU5D</p></blockquote><h2 id="10-vMotion"><a href="#10-vMotion" class="headerlink" title="10 vMotion"></a>10 vMotion</h2><h3 id="10-1-相关错误提示参考"><a href="#10-1-相关错误提示参考" class="headerlink" title="10.1 相关错误提示参考"></a>10.1 相关错误提示参考</h3><p>要实现vMotion迁移功能，必须先进行vMotion配置。</p><p>不事先配置vMotion情况下，直接将虚拟机主动迁移或者开启<code>DRS</code>功能，均无法实现。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022329548.png" alt="image-20210615081105898"></p><p>点击详细信息提示</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022331126.png" alt="image-20210615081038626"></p><h3 id="10-2-分布式交换机相关说明"><a href="#10-2-分布式交换机相关说明" class="headerlink" title="10.2 分布式交换机相关说明"></a>10.2 分布式交换机相关说明</h3><p>在本次章节中，我们通过两个场景，分别是vMotion配置以及虚拟机网络配置，将vShpere7中的分布式交换机实战进行讲解。</p><p>在不使用分布式交换机之前，我们是针对各ESXi主机进行添加虚拟交换机配置</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022331064.png" alt="image-20210615082657749"></p><p>带来的问题是，必须针对各ESXi主机进行设置，需要重复操作，各主机之间无法共享。</p><p>使用分布式交换机是基于ESXi各主机之上，创建统一的虚拟交换机，可以创建多个虚拟分布式交换机，你可以简单理解为有多少个物理网卡，我可以有针对性的创建几台虚拟分布式交换机。</p><p>创建虚拟分布式交换机的步骤可以参考《7 vSAN网络部署》章节。</p><p>在实际的操作过程中，会对VMKerner、端口组、上行链路等概念混淆，或者不容易对其理解。</p><p>这里我用一张逻辑图将上述概念进行简单阐述。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022331410.png" alt="image-20210623234131642"></p><p>对应的在vCenter中查看拓扑图</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022331128.png" alt="image-20210624141450519"></p><h3 id="10-3-配置vMotion设置"><a href="#10-3-配置vMotion设置" class="headerlink" title="10.3 配置vMotion设置"></a>10.3 配置vMotion设置</h3><p>我们新建一个分布式交换机，对应ESXi主机或者称之每台物理服务器（这个没有冲突）的各自两个物理端口。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022331517.png" alt="image-20210615083317910"></p><blockquote><p>这里我将vMotion的网络和业务网络进行了复用，实际生产环境下建议进行各自独立的划分。</p></blockquote><p>我们在当前已建立好的分布式交换机下新增一个专门用于vMotion的专用端口组</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022332936.png" alt="image-20210615131053741"></p><p>新建专用的端口组后，再添加VMKernel</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022332362.png" alt="image-20210615132158939"></p><p>同样的第一步先添加主机</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022332322.png" alt="image-20210615132244973"></p><p>下一步开始配置VMkernel适配器</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022332159.png" alt="image-20210615143046966"></p><p>进行IP地址设置，场景类似《7 vSAN网络部署》章节。只不过流量走的是vMotion场景下的数据。</p><p><img src="https://cdn.jsdelivr.net/gh/terrydai928/blog-img/202404022332812.png" alt="image-20210615143427357"></p><h2 id="11-监控和故障处理"><a href="#11-监控和故障处理" class="headerlink" title="11 监控和故障处理"></a>11 监控和故障处理</h2><p>可以参考官网vSAN 故障处理</p><p><a target="_blank" rel="noopener" href="https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.vsphere.vsan-monitoring.doc/GUID-35A4B700-6640-4519-A885-440A1AE8D3BD.html">https://docs.vmware.com/cn/VMware-vSphere/7.0/com.vmware.vsphere.vsan-monitoring.doc/GUID-35A4B700-6640-4519-A885-440A1AE8D3BD.html</a></p><p>后续有时间单独针对trouble shooting写一篇文章。</p></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://www.yinhai-blog.com">Terry Dai</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://www.yinhai-blog.com/post/156415027.html">https://www.yinhai-blog.com/post/156415027.html</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.yinhai-blog.com" target="_blank">银海博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E8%99%9A%E6%8B%9F%E5%8C%96/">虚拟化</a><a class="post-meta__tags" href="/tags/vSAN/">vSAN</a></div><div class="post_share"><div class="social-share" data-image="/img/Avatar.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload='this.media="all"'><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i>赞助</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="微信"></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="支付宝"></a><div class="post-qr-code-desc">支付宝</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/post/2437986504.html" title="VMware workstation设置 虚拟机开机启动_vmware自动开启虚拟机"><div class="cover" style="background:var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">VMware workstation设置 虚拟机开机启动_vmware自动开启虚拟机</div></div></a></div><div class="next-post pull-right"><a href="/post/3274621697.html" title="图解VMware vSAN安装(上：硬件及vSphere部署)"><div class="cover" style="background:var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">图解VMware vSAN安装(上：硬件及vSphere部署)</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/post/3274621697.html" title="图解VMware vSAN安装(上：硬件及vSphere部署)"><div class="cover" style="background:var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-23</div><div class="title">图解VMware vSAN安装(上：硬件及vSphere部署)</div></div></a></div><div><a href="/post/3677894519.html" title="Horizon Connection Server 外部登入提示登录失败"><div class="cover" style="background:var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-18</div><div class="title">Horizon Connection Server 外部登入提示登录失败</div></div></a></div><div><a href="/post/2041350213.html" title="搭建VMware Horizon8私有云桌面虚拟化(一)安装Horizon Connection Server8"><div class="cover" style="background:var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-17</div><div class="title">搭建VMware Horizon8私有云桌面虚拟化(一)安装Horizon Connection Server8</div></div></a></div><div><a href="/post/1562883640.html" title="搭建VMware Horizon8私有云桌面虚拟化(三)部署设置vCenter Server Appliance"><div class="cover" style="background:var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-18</div><div class="title">搭建VMware Horizon8私有云桌面虚拟化(三)部署设置vCenter Server Appliance</div></div></a></div><div><a href="/post/1817709106.html" title="搭建VMware Horizon8私有云桌面虚拟化(二)安装SQL数据库与View Composer(可跳过安装Composer步骤)"><div class="cover" style="background:var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-18</div><div class="title">搭建VMware Horizon8私有云桌面虚拟化(二)安装SQL数据库与View Composer(可跳过安装Composer步骤)</div></div></a></div><div><a href="/post/1807458936.html" title="搭建VMware Horizon8私有云桌面虚拟化(七)Horizon 创建桌面池连接SqlServer数据库"><div class="cover" style="background:var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-01-22</div><div class="title">搭建VMware Horizon8私有云桌面虚拟化(七)Horizon 创建桌面池连接SqlServer数据库</div></div></a></div></div></div><hr class="custom-hr"><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/Avatar.png" onerror='this.onerror=null,this.src="/img/friend_404.gif"' alt="avatar"></div><div class="author-info__name">Terry Dai</div><div class="author-info__description">慵懒岁月缓缓流，时光悠悠似轻舟。梦境深处懒影婆，心随风荡懒云游。</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">44</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">22</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://terrydai928.gitee.io/"><i class="fa fa-clone"></i><span>Gitee镜像网站</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://githubfast.com/terrydai928" target="_blank" title="Github"><i class="fab fa-github" style="color:#24292e"></i></a><a class="social-icon" href="https://blog.csdn.net/terrydai" target="_blank" title="CSDN"><i class="fa fa-book-open" style="color:#2897af"></i></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=10544631&amp;website=www.oicqzone.com" target="_blank" title="QQ"><i class="fab fa-qq" style="color:#e95e44"></i></a><a class="social-icon" href="mailto:terry.dai@qq.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text" style="color:#4a7dbe"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">欢迎光临我的个人博客，这里是我日常工作和学习中收集和整理的总结，希望能对你有所帮助.<br><br>本站的内容经过个人加工总结而来,也参考了网友们分享的资料，如有侵权,请第—时间联系我，我将及时进行修改或删除。感谢</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#1-vSAN%E9%83%A8%E7%BD%B2%E8%A6%81%E6%B1%82"><span class="toc-number">2.</span> <span class="toc-text">1 vSAN部署要求</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-vSAN%E5%AD%98%E5%82%A8%E8%AE%BE%E8%AE%A1"><span class="toc-number">3.</span> <span class="toc-text">2 vSAN存储设计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2-1-%E9%9B%86%E7%BE%A4%E7%89%B9%E6%80%A7"><span class="toc-number">3.1.</span> <span class="toc-text">2.1 集群特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-2-%E9%85%8D%E7%BD%AE%E8%B6%B3%E5%A4%9F%E7%9A%84%E4%B8%B4%E6%97%B6%E7%A9%BA%E9%97%B4"><span class="toc-number">3.2.</span> <span class="toc-text">2.2 配置足够的临时空间</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-3-vSAN%E6%8E%A7%E5%88%B6%E5%99%A8%E8%AE%BE%E8%AE%A1%E4%BC%98%E5%8C%96"><span class="toc-number">3.3.</span> <span class="toc-text">2.3 vSAN控制器设计优化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-vSAN%E8%AE%BE%E8%AE%A1%E5%92%8C%E4%BC%98%E5%8C%96"><span class="toc-number">4.</span> <span class="toc-text">3 vSAN设计和优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-vSAN%E9%9B%86%E7%BE%A4%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-number">5.</span> <span class="toc-text">4 vSAN集群的设计注意事项</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#4-1-%E8%B0%83%E6%95%B4vSAN%E9%9B%86%E7%BE%A4%E7%9A%84%E5%A4%A7%E5%B0%8F%E4%BB%A5%E5%85%81%E8%AE%B8%E6%95%85%E9%9A%9C"><span class="toc-number">5.1.</span> <span class="toc-text">4.1 调整vSAN集群的大小以允许故障</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-2-%E5%8F%8C%E4%B8%BB%E6%9C%BA%E6%88%96%E4%B8%89%E4%B8%BB%E6%9C%BA%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE%E7%9A%84%E9%99%90%E5%88%B6"><span class="toc-number">5.2.</span> <span class="toc-text">4.2 双主机或三主机集群配置的限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-3-%E5%B9%B3%E8%A1%A1%E5%92%8C%E4%B8%8D%E5%B9%B3%E8%A1%A1%E7%9A%84%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE"><span class="toc-number">5.3.</span> <span class="toc-text">4.3 平衡和不平衡的集群配置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-4-%E5%9C%A8-vSAN-%E4%B8%8A%E9%83%A8%E7%BD%B2-vCenter-Server"><span class="toc-number">5.4.</span> <span class="toc-text">4.4 在 vSAN 上部署 vCenter Server</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-vSAN-%E7%BD%91%E7%BB%9C"><span class="toc-number">6.</span> <span class="toc-text">5 vSAN 网络</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#5-1-%E7%BD%91%E7%BB%9C%E6%95%85%E9%9A%9C%E5%88%87%E6%8D%A2%E5%92%8C%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1"><span class="toc-number">6.1.</span> <span class="toc-text">5.1 网络故障切换和负载均衡</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-2-%E4%BD%BF%E7%94%A8-Network-I-O-Control-%E4%B8%BA-vSAN-%E5%88%86%E9%85%8D%E5%B8%A6%E5%AE%BD"><span class="toc-number">6.2.</span> <span class="toc-text">5.2 使用 Network I&#x2F;O Control 为 vSAN 分配带宽</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-3-vSAN%E7%BD%91%E7%BB%9C%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5"><span class="toc-number">6.3.</span> <span class="toc-text">5.3 vSAN网络最佳实践</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-vSAN%E9%83%A8%E7%BD%B2%E6%AD%A5%E9%AA%A4"><span class="toc-number">7.</span> <span class="toc-text">6 vSAN部署步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-vSAN%E7%BD%91%E7%BB%9C%E9%83%A8%E7%BD%B2"><span class="toc-number">8.</span> <span class="toc-text">7 vSAN网络部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#7-1-%E6%96%B0%E5%BB%BA%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%A4%E6%8D%A2%E6%9C%BA"><span class="toc-number">8.1.</span> <span class="toc-text">7.1 新建分布式交换机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-2-%E6%B7%BB%E5%8A%A0%E5%92%8C%E7%AE%A1%E7%90%86%E4%B8%BB%E6%9C%BA"><span class="toc-number">8.2.</span> <span class="toc-text">7.2 添加和管理主机</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-3-%E6%B7%BB%E5%8A%A0VMkernel%E9%80%82%E9%85%8D%E5%99%A8"><span class="toc-number">8.3.</span> <span class="toc-text">7.3 添加VMkernel适配器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-4-%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E9%83%A8%E7%BD%B2"><span class="toc-number">8.4.</span> <span class="toc-text">7.4 链路聚合部署</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-5-vSAN%E7%BD%91%E7%BB%9C%E9%AA%8C%E8%AF%81"><span class="toc-number">8.5.</span> <span class="toc-text">7.5 vSAN网络验证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-6-%E7%89%A9%E7%90%86%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9A%84%E8%B7%A8%E8%AE%BE%E5%A4%87%E9%93%BE%E8%B7%AF%E8%81%9A%E5%90%88%E9%85%8D%E7%BD%AE"><span class="toc-number">8.6.</span> <span class="toc-text">7.6 物理交换机的跨设备链路聚合配置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-vSAN%E9%83%A8%E7%BD%B2"><span class="toc-number">9.</span> <span class="toc-text">8 vSAN部署</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#8-1-%E5%90%AF%E7%94%A8vSAN"><span class="toc-number">9.1.</span> <span class="toc-text">8.1 启用vSAN</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-2-%E8%AE%B8%E5%8F%AF%E8%AF%81"><span class="toc-number">9.2.</span> <span class="toc-text">8.2 许可证</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-3-%E5%8A%9F%E8%83%BD%E9%AA%8C%E8%AF%81"><span class="toc-number">9.3.</span> <span class="toc-text">8.3 功能验证</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#9-%E5%85%B6%E4%BB%96%E5%87%A0%E4%B8%AA%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98"><span class="toc-number">10.</span> <span class="toc-text">9 其他几个常见问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#9-1-%E8%8E%B7%E5%8F%96%E6%9C%80%E6%96%B0%E7%9A%84-HCL-%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%88%E6%9C%AC"><span class="toc-number">10.1.</span> <span class="toc-text">9.1 获取最新的 HCL 数据库版本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-2-%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5"><span class="toc-number">10.2.</span> <span class="toc-text">9.2 时间同步</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-3-%E4%B8%8B%E8%BD%BD%E6%9C%80%E6%96%B0%E7%9A%84-vSAN-%E7%89%88%E6%9C%AC%E7%9B%AE%E5%BD%95"><span class="toc-number">10.3.</span> <span class="toc-text">9.3 下载最新的 vSAN 版本目录</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-4-%E9%87%8D%E6%96%B0%E8%AE%BE%E7%BD%AEvSAN%E9%85%8D%E7%BD%AE%E5%87%BA%E7%8E%B0%E7%9A%84%E5%B7%B2%E6%9C%89%E5%88%86%E5%8C%BA%E6%8A%A5%E9%94%99"><span class="toc-number">10.4.</span> <span class="toc-text">9.4 重新设置vSAN配置出现的已有分区报错</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-5-%E5%BA%8F%E5%88%97%E5%8F%B7"><span class="toc-number">10.5.</span> <span class="toc-text">9.5 序列号</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#10-vMotion"><span class="toc-number">11.</span> <span class="toc-text">10 vMotion</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#10-1-%E7%9B%B8%E5%85%B3%E9%94%99%E8%AF%AF%E6%8F%90%E7%A4%BA%E5%8F%82%E8%80%83"><span class="toc-number">11.1.</span> <span class="toc-text">10.1 相关错误提示参考</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-2-%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%A4%E6%8D%A2%E6%9C%BA%E7%9B%B8%E5%85%B3%E8%AF%B4%E6%98%8E"><span class="toc-number">11.2.</span> <span class="toc-text">10.2 分布式交换机相关说明</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-3-%E9%85%8D%E7%BD%AEvMotion%E8%AE%BE%E7%BD%AE"><span class="toc-number">11.3.</span> <span class="toc-text">10.3 配置vMotion设置</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#11-%E7%9B%91%E6%8E%A7%E5%92%8C%E6%95%85%E9%9A%9C%E5%A4%84%E7%90%86"><span class="toc-number">12.</span> <span class="toc-text">11 监控和故障处理</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/3883376956.html" title="工控安全与传统安全的区别">工控安全与传统安全的区别</a><time datetime="2024-04-02T14:34:59.198Z" title="发表于 2024-04-02 22:34:59">2024-04-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/1557300456.html" title="自动将完整桌面池虚拟机加入到指定OU脚本说明">自动将完整桌面池虚拟机加入到指定OU脚本说明</a><time datetime="2024-03-18T16:00:00.000Z" title="发表于 2024-03-19 00:00:00">2024-03-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/fa31a270.html" title="ESXI 添加利旧的硬盘时提示无法创建 VMFS 数据存储及无法更新磁盘分区的解决办法">ESXI 添加利旧的硬盘时提示无法创建 VMFS 数据存储及无法更新磁盘分区的解决办法</a><time datetime="2024-02-02T02:00:00.000Z" title="发表于 2024-02-02 10:00:00">2024-02-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/2437986504.html" title="VMware workstation设置 虚拟机开机启动_vmware自动开启虚拟机">VMware workstation设置 虚拟机开机启动_vmware自动开启虚拟机</a><time datetime="2023-03-24T00:30:00.000Z" title="发表于 2023-03-24 08:30:00">2023-03-24</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/post/156415027.html" title="图解VMware vSAN安装(下：vSAN部署及管理安装)">图解VMware vSAN安装(下：vSAN部署及管理安装)</a><time datetime="2022-05-26T16:00:00.000Z" title="发表于 2022-05-27 00:00:00">2022-05-27</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Terry Dai</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi, 欢迎来到我的 <a href="https://www.yinhai-blog.com/">博客</a>!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">简</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=4.13.0"></script><script src="/js/main.js?v=4.13.0"></script><script src="/js/tw_cn.js?v=4.13.0"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui@5.0.33/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"><script>if(window.MathJax)MathJax.startup.document.state(0),MathJax.texReset(),MathJax.typesetPromise();else{window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]],tags:"ams"},chtml:{scale:1.1},options:{renderActions:{findScript:[10,t=>{for(const n of document.querySelectorAll('script[type^="math/tex"]')){var e=!!n.type.match(/; *mode=display/),e=new t.options.MathItem(n.textContent,t.inputJax[0],e),a=document.createTextNode("");n.parentNode.replaceChild(a,n),e.start={node:a,delim:"",n:0},e.end={node:a,delim:"",n:0},t.math.push(e)}},""]}}};const a=document.createElement("script");a.src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.min.js",a.id="MathJax-script",a.async=!0,document.head.appendChild(a)}</script><script>(()=>{const e=document.querySelectorAll("#article-container .mermaid-wrap");if(0!==e.length){const n=()=>{window.loadMermaid=!0;const r="dark"===document.documentElement.getAttribute("data-theme")?"dark":"default";Array.from(e).forEach((e,t)=>{const n=e.firstElementChild;e="%%{init:{ 'theme':'"+r+"'}}%%\n"+n.textContent;const d=mermaid.render("mermaid-"+t,e);"string"==typeof d?(t=d,n.insertAdjacentHTML("afterend",t)):d.then(({svg:e})=>{n.insertAdjacentHTML("afterend",e)})})};var t=()=>{window.loadMermaid?n():getScript("https://cdn.jsdelivr.net/npm/mermaid@10.8.0/dist/mermaid.min.js").then(n)};btf.addGlobalFn("themeChange",n,"mermaid"),window.pjax?t():document.addEventListener("DOMContentLoaded",t)}})()</script><script>(()=>{const t=()=>{const o=document.getElementById("twikoo-count");o&&twikoo.getCommentsCount({envId:"https://main--yinhai.netlify.app/.netlify/functions/twikoo",region:"ap-shanghai",urls:[window.location.pathname],includeReply:!1}).then(t=>{o.textContent=t[0].count}).catch(t=>{console.error(t)})},o=()=>{twikoo.init(Object.assign({el:"#twikoo-wrap",envId:"https://main--yinhai.netlify.app/.netlify/functions/twikoo",region:"ap-shanghai",onCommentLoaded:()=>{btf.loadLightbox(document.querySelectorAll("#twikoo .tk-content img:not(.tk-owo-emotion)"))}},null)),GLOBAL_CONFIG_SITE.isPost&&t()};var n=()=>{"object"==typeof twikoo?setTimeout(o,0):getScript("https://cdn.jsdelivr.net/npm/twikoo@1.6.31/dist/twikoo.all.min.js").then(o)};n()})()</script></div><script src="/js/script.js?1"></script><script src="/js/script1.js?1"></script><script src="/js/script2.js?1"></script><script defer id="fluttering_ribbon" mobile="null" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="canvas_nest" defer color="0,0,255" opacity="0.7" zindex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.3/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span> 数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"></div></div><hr><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js?v=4.13.0"></script></div></div><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>